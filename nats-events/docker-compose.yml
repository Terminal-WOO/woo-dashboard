version: "3.8"

services:
  nats:
    image: nats:2.10-alpine
    container_name: nats-jetstream
    restart: unless-stopped
    ports:
      - "4222:4222" # Client connections
      - "8222:8222" # HTTP monitoring
      - "6222:6222" # Cluster routing
    command:
      - "-js"
      - "-sd"
      - "/data"
      - "-m"
      - "8222"
      - "--name"
      - "nats-dms"
    volumes:
      - nats_data:/data
    networks:
      - dms-network

  # NATS Event Consumer Service
  event-consumer:
    build: ./consumer
    container_name: nats-event-consumer
    restart: unless-stopped
    depends_on:
      - nats
    environment:
      NATS_URL: nats://nats:4222
      CONSUMER_NAME: document-event-consumer
      STREAM_NAME: DOCUMENT_EVENTS
      LOG_LEVEL: info
    ports:
      - "3002:3000" # HTTP API voor event queries
    networks:
      - dms-network

volumes:
  nats_data:

networks:
  dms-network:
    name: dms-network
    driver: bridge
